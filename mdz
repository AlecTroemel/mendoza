#!/usr/bin/env janet

# Increase interval so GC doesn't slow down program as much.
(gcsetinterval 0x7FFFFF)

(import mendoza :as mdz)

(mdz/init)

(def args
  (if-let [e (dyn 'process/args)]
    (array/slice (e :value) 0 1)
    (dyn :args)))

(def usage
  "Script usage."
``` [action]

  Actions:
    help               - Print this usage information
    build              - Create the static site in the 'site' directory
    clean              - Destory the static site directory
    serve [port=8000]  - Serves current site. Uses python3 to serve.
    watch              - Watch files and rebuild if any change.
    version            - Print the mendoza version
```)

(var action "build")
(if (>= (length args) 2)
  (set action (args 1)))

(gccollect)

# Do actions
(case action
  "help" (print (args 0) usage)
  "version" (print mdz/version)
  "clean" (mdz/clean)
  "serve" (mdz/serve (if (> (length args) 2) (args 2)))
  "watch" (mdz/watch)
  "build" (mdz/build))
